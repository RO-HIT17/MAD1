<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='quizmanagement.css') }}">
</head>
<body>

    
    <header class="header">
        <div class="nav-links">
            <a href="{{ url_for('admin_dashboard') }}">Home</a> | 
            <a href="{{ url_for('quiz_management') }}">Quiz</a> | 
            <a href="{{ url_for('admin_summary') }}">Summary</a> | 
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>

        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search subject...">
            <button onclick="searchSubjects()">Search üîç</button>
        </div>

        <div class="admin-welcome">Welcome, Admin</div>
    </header>

    
    <section class="quiz-list">
        {% for quiz in quizzes %}
        <div class="quiz-box">
            <h3>Quiz - {{ quiz.chapter.name if quiz.chapter else 'No Chapter' }}</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Question</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for question in quiz.questions %}
                    <tr>
                        <td>{{ question.id }}</td>
                        <td>{{ question.question_statement }}</td>
                        <td>
                            <button class="edit-btn" onclick="openEditModal(
                                {{ question.id }}, 
                                '{{ question.question_title }}', 
                                '{{ question.question_statement }}', 
                                '{{ question.option1 }}', 
                                '{{ question.option2 }}', 
                                '{{ question.option3 or '' }}', 
                                '{{ question.option4 or '' }}', 
                                '{{ question.correct_option }}'
                            )">‚úèÔ∏è Edit</button>

                            <form action="{{ url_for('delete_question', question_id=question.id) }}" method="POST" class="delete-form">
                                <button type="submit" class="delete-btn" onclick="return confirmDelete();">üóëÔ∏è Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <a href="{{ url_for('new_question', quiz_id=quiz.id) }}">
                <button class="add-question">+ Add Question</button>
            </a>
        </div>
        {% endfor %}
    </section>

    <a href="{{ url_for('new_quiz') }}">
        <button class="new-quiz">+ Create New Quiz</button>
    </a>

    
    <div id="editQuestionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Edit Question</h2>
            <form id="editQuestionForm" method="POST">
                <input type="hidden" name="question_id" id="question_id">

                <label for="question_title">Question Title:</label>
                <input type="text" id="question_title" name="question_title" required>

                <label for="question_statement">Question Statement:</label>
                <textarea id="question_statement" name="question_statement" required></textarea>

                <label for="option1">Option 1:</label>
                <input type="text" id="option1" name="option1" required>

                <label for="option2">Option 2:</label>
                <input type="text" id="option2" name="option2" required>

                <label for="option3">Option 3:</label>
                <input type="text" id="option3" name="option3">

                <label for="option4">Option 4:</label>
                <input type="text" id="option4" name="option4">

                <label for="correct_option">Correct Option:</label>
                <select id="correct_option" name="correct_option" required>
                    <option value="1">Option 1</option>
                    <option value="2">Option 2</option>
                    <option value="3">Option 3</option>
                    <option value="4">Option 4</option>
                </select>

                <div class="button-group">
                    <button type="submit">Save Changes</button>
                    <button type="button" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            closeEditModal(); // Ensure modal is closed on page load
        });

        function searchSubjects() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let subjectCards = document.querySelectorAll(".quiz-box"); // Assuming each quiz box is a subject card
        
            subjectCards.forEach(card => {
                let subjectName = card.querySelector("h3").textContent.toLowerCase();
                if (subjectName.includes(input)) {
                    card.style.display = "block"; // Show the matching subject
                } else {
                    card.style.display = "none"; // Hide non-matching subjects
                }
            });
        }

        function openEditModal(id, title, statement, opt1, opt2, opt3, opt4, correctOpt) {
            document.getElementById('editQuestionModal').style.display = 'block';
            document.getElementById('question_id').value = id;
            document.getElementById('question_title').value = title;
            document.getElementById('question_statement').value = statement;
            document.getElementById('option1').value = opt1;
            document.getElementById('option2').value = opt2;
            document.getElementById('option3').value = opt3 || "";
            document.getElementById('option4').value = opt4 || "";
            document.getElementById('correct_option').value = correctOpt;
            document.getElementById('editQuestionForm').action = `/question/edit/${id}`;
        }

        function closeEditModal() {
            document.getElementById('editQuestionModal').style.display = 'none';
        }

        function confirmDelete() {
            return confirm("Are you sure you want to delete this question? This action cannot be undone.");
        }
        document.getElementById("searchInput").addEventListener("keyup", searchSubjects);
    </script>
</body>
</html>
